<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Spice up Thy Jupyter Notebooks With mypy</title>
  
  <meta name="author" content="Stephan Fitzpatrick"/>
  <meta name="generator" content="Hugo 0.18.1" />
  <link href='https://knowsuchagency.github.io/img/lambda.ico' rel='icon' type='image/x-icon'/>

  <link rel="alternate" href="https://knowsuchagency.github.io/index.xml" type="application/rss+xml" title="Journal Panic">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://knowsuchagency.github.io/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://knowsuchagency.github.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://knowsuchagency.github.io/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://knowsuchagency.github.iocss/highlight.min.css">
  
  
  <meta property="og:title" content="Spice up Thy Jupyter Notebooks With mypy" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/post/spice-up-thy-jupyter-notebooks-with-mypy/" />
  <meta property="og:image" content="/img/lambda.png" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://knowsuchagency.github.io">Journal Panic</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
          <a title="Blog" href="https://knowsuchagency.github.io/">Blog</a>
  	      </li>
  	    
      
        
          <li>
          <a title="About" href="https://knowsuchagency.github.io/page/about/">About</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Resume" href="https://knowsuchagency.github.io/page/resume/">Resume</a>
  	      </li>
  	    
      
      </ul>
    </div>

	<div class="avatar-container">
	  <div class="avatar-img-border">
      
          <a title="Journal Panic" href="https://knowsuchagency.github.io">
              <img class="avatar-img" src="https://knowsuchagency.github.io/img/lambda.png" alt="Journal Panic" />
          </a>
      
	  </div>
	</div>

  </div>
</nav>

    



  

  <header class="header-section ">
  
  <div class="intro-header no-img">
      <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Spice up Thy Jupyter Notebooks With mypy</h1>
      
        
      <h2 class="post-subheading">Add type-checking to Jupyter Notebook cells</h2>
      
      
      
      
      <span class="post-meta">Posted on March 19, 2017</span>
      
        </div>
      </div>
    </div>
  </div>
  </div>
  </header>


    <div class="container" role="main">	  
      
        <div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
          <p></p>

<p>I use <a href="http://jupyter.org/">Jupyter</a> notebooks all the time. I use them to author the content for articles like the one you&rsquo;re reading. I use them to explore data. And I use them whenever I want to prototype standalone modules or learn new programming concepts, since notebooks allow us to quickly iterate on new ideas and provide powerful ways introspect, profile, and debug code - and more.</p>

<p>Before I continue on my rant, let&rsquo;s quickly take a look at some code to demonstrate what we want to be able to do.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">%%</span><span class="n">typecheck</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">missing</span><span class="o">-</span><span class="n">imports</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">sympify</span><span class="p">,</span> <span class="n">init_printing</span>
<span class="n">init_printing</span><span class="p">()</span>

<span class="n">integer</span><span class="p">:</span> <span class="nb">int</span>
    
<span class="n">integer</span> <span class="o">=</span> <span class="s2">&quot;mypy won&#39;t like this&quot;</span>

<span class="n">expr</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="s1">&#39;(e**3)**(1/2)&#39;</span><span class="p">)</span> 

<span class="c1"># The following will be pretty printed, not just the last expression</span>
<span class="c1"># since the I have configured IPython as such and the typecheck</span>
<span class="c1"># magic uses the current profile</span>

<span class="n">expr</span>

<span class="mi">5</span>
</code></pre></div>

<pre><code>&lt;string&gt;:7: error: Incompatible types in assignment (expression has type &quot;str&quot;, variable has type &quot;int&quot;)
</code></pre>

<p>$$\sqrt{e^{3}}$$
$$5$$</p>

<p>I&rsquo;ve recently become interested in Python&rsquo;s new typing module and <a href="http://mypy-lang.org/">mypy</a>, and I wanted to be able to use them seamlessly in the context of my Jupyter notebooks.</p>

<p>I should mention that Jupyter is an evolution of the original IPython project. I bring this up because I&rsquo;m going to reference the documentation for IPython, which can be thought of as the the code that enables Python to work with Jupyter. Think of Jupyter as the tooling that allows for us to do all the fancy code editing and visualization browser, and IPython as the compatibility layer between Jupyter and Python. This is a bit simplistic, but hopefully avoids confusion for anyone who isn&rsquo;t intimately familiar with both projects and the genesis of the Jupyter project.</p>

<p>Jupyter has a concept of cell &ldquo;magics&rdquo; which allow us to perform helpful functions in the context of a Jupyter shell. For example, when using IPython, the <code>%pastebin</code> magic allows us to easily upload bits of code to Github&rsquo;s Gist pastebin, <code>%pdoc [object]</code> prints the docstring for a particular object, and <code>%%latex</code> renders a block of text as latex.</p>

<p>Magics that start with  &lsquo;%&rsquo; apply only to the line that it is written on, while
magics that start with &lsquo;%%&rsquo; apply to a block of code proceeding that line.</p>

<p>Jupyter allows us to write our own custom magics, apart from the built-in magics provided. Detailed documentation on how to do that can be found <a href="http://ipython.readthedocs.io/en/stable/config/custommagics.html">here</a>.</p>

<p>Since the custom magics you use depend on how you have IPython configured and what profile you&rsquo;re using, I&rsquo;m providing the following code in the form of a gist, since distributing it as a package would be finicky as the package would need to attempt to figure out your IPython configuration, a task which seems best left to you, the human.</p>

<p>I&rsquo;m going to assume that you have Jupyter installed and that you have at least a default profile created. <code>pip install -U jupyter mypy</code> will install Jupyter and mypy, while <code>ipython profile create</code> will create a default profile for you if you don&rsquo;t yet have one. This will allow you to use custom magics and configure the way IPython works in various other ways. Once you have a profile created, you can use <code>ipython locate profile</code> to find the configuration directory for that profile.</p>

<p>For example, the IPython configuration file for my default profile, &lsquo;ipython_config.py&rsquo; has the following lines</p>

<pre><code>c.TerminalInteractiveShell.ast_node_interactivity = 'all'
c.InteractiveShell.ast_node_interactivity = 'all'
</code></pre>

<p>which tells IPython to print the the repr for any object which has it&rsquo;s own line.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
<span class="n">bar</span> <span class="o">=</span> <span class="s1">&#39;baz&#39;</span>

<span class="n">foo</span>
<span class="n">bar</span> <span class="c1"># normally, only this object is printed</span>
</code></pre></div>

<pre><code>'bar'
'baz'
</code></pre>

<p>I wanted my magic to do 4 things.</p>

<ol>
<li>Run the block of code through mypy and print its output</li>
<li>Allow me to alter mypy&rsquo;s behavior, as with the mypy cli</li>
<li>Not conflict with the normal behavior of the block of code</li>
<li>Run the block of code in the context of my current profile</li>
</ol>

<p>Though the code it took to do this is really straightforward, it took some digging around in the Jupyter and IPython docs to get it to work as I wanted. Hopefully you find it useful and elucidating.</p>

<p>Without further ado, <script src="//gist.github.com/knowsuchagency/f7b2203dd613756a45f816d6809f01a6.js"></script></p>
      </article>

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="https://knowsuchagency.github.io/post/postmodern-error-handling/" data-toggle="tooltip" data-placement="top" title="Postmodern Error Handling in Python 3.6">&larr; Previous Post</a>
        </li>
        
        
      </ul>

      
      <div class="disqus-comments">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'journal-panic';
    var disqus_identifier = 'https:\/\/knowsuchagency.github.io\/post\/spice-up-thy-jupyter-notebooks-with-mypy\/';
    var disqus_title = 'Spice up Thy Jupyter Notebooks With mypy';
    var disqus_url = 'https:\/\/knowsuchagency.github.io\/post\/spice-up-thy-jupyter-notebooks-with-mypy\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
      

    </div>
  </div>
</div>

      
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          <li>
            <a href="https://www.facebook.com/stephan.fitzpatrick" title="Facebook">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li>
            <a href="https://github.com/knowsuchagency" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
          <li>
            <a href="https://twitter.com/knowsuchagency" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
          <li>
            <a href="mailto:knowsuchagency@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
          <li>
            <a href="https://linkedin.com/in/fitzpatrickstephan" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
	    	  
          <li>
            <a href="https://stackoverflow.com/users/5933618/stephan-fitzpatrick" title="StackOverflow">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          <li>
            <a href="https://www.instagram.com/knowsuchagency" title="Instagram">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
           
          
          
          

    		  <li>
      			<a href="https://knowsuchagency.github.ioindex.xml" title="RSS">
      			  <span class="fa-stack fa-lg">
        				<i class="fa fa-circle fa-stack-2x"></i>
        				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      			  </span>
      			</a>
    		  </li>		

        </ul>
        <p class="credits copyright text-muted">
    	  Stephan Fitzpatrick
    	  &nbsp;&bull;&nbsp;
    	  2017
    		  
    	  
    	  &nbsp;&bull;&nbsp;
    	  <a href="https://knowsuchagency.github.io">Journal Panic</a>
    	  
  	    </p>
  	    
      </div>
    </div>
  </div>
</footer>

<script src="https://knowsuchagency.github.io/js/jquery-1.11.2.min.js"></script>
<script src="https://knowsuchagency.github.io/js/bootstrap.min.js"></script>
<script src="https://knowsuchagency.github.io/js/main.js"></script>
<script src="https://knowsuchagency.github.iojs/highlight.min.js"></script>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  hljs.initHighlightingOnLoad();
</script>




  </body>
</html>
